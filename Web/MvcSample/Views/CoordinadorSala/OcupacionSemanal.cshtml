@using Services.Models.ModelosComputador
@model OcupacionSemanalModel

@{
    ViewData["Title"] = "Ocupación semanal";
    var inicioAnterior = Model.InicioSemana.AddDays(-7).ToString("yyyy-MM-dd");
    var inicioSiguiente = Model.InicioSemana.AddDays(7).ToString("yyyy-MM-dd");
}

<div class="equipos-table-container">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <div>
            <h2>Ocupación semanal</h2>
            <p>@Model.InicioSemana.ToString("dd MMM") - @Model.FinSemana.ToString("dd MMM")</p>
        </div>
        <div class="acciones-derecha d-flex gap-2">
            <a class="btn-agregar-equipo" asp-action="OcupacionSemanal" asp-route-inicioSemana="@inicioAnterior">
                <i class="bi bi-arrow-left me-1"></i>Semana anterior
            </a>
            <a class="btn-agregar-equipo" asp-action="OcupacionSemanal" asp-route-inicioSemana="@inicioSiguiente">
                Siguiente semana<i class="bi bi-arrow-right ms-1"></i>
            </a>
            <a class="btn-agregar-equipo" asp-action="Principal">
                <i class="bi bi-arrow-left-circle me-1"></i>Volver
            </a>
        </div>
    </div>

    <table class="table equipos-table">
        <thead>
            <tr>
                <th>Sala</th>
                @foreach (var dia in Model.DiasSemana)
                {
                    <th>@dia.ToString("ddd dd")</th>
                }
                <th>Promedio semanal</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Salas == null || Model.Salas.Count == 0)
            {
                <tr>
                    <td colspan="@(Model.DiasSemana.Count + 2)" class="text-center text-muted py-4">No hay salas registradas</td>
                </tr>
            }
            else
            {
                foreach (var sala in Model.Salas)
                {
                    <tr>
                        <td>@sala.SalaNombre</td>
                        @foreach (var dia in Model.DiasSemana)
                        {
                            if (sala.OcupacionPorDia.TryGetValue(dia.Date, out var info))
                            {
                                <td>
                                    <div class="d-flex flex-column">
                                        <small>@info.EquiposOcupados/@info.EquiposRegistrados</small>
                                        <span class="tag tag-mantenimiento">@info.PorcentajeOcupacion %</span>
                                    </div>
                                </td>
                            }
                            else
                            {
                                <td>
                                    <div class="d-flex flex-column">
                                        <small>0/@sala.EquiposRegistrados</small>
                                        <span class="tag tag-disponible">0 %</span>
                                    </div>
                                </td>
                            }
                        }
                        <td><span class="tag tag-mantenimiento">@sala.PromedioSemanal %</span></td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

