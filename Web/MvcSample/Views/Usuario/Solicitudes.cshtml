@model IList<Services.Models.ModelosSolicitud.ModeloSolicitud>

@{
    ViewData["Title"] = "Mis solicitudes";
    var equipos = ViewBag.Computadores as IDictionary<Guid, string> ?? new Dictionary<Guid, string>();
    var salas = ViewBag.SalasDic as IDictionary<Guid, string> ?? new Dictionary<Guid, string>();
}

<div class="equipos-table-container">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <div>
            <h2>Mis solicitudes</h2>
            <p>Revisa el estado de tus solicitudes y reportes</p>
        </div>
        <div class="d-flex gap-2">
            <a class="btn btn-primary" asp-action="CrearSolicitud" asp-route-tipo="Asignacion">
                <i class="bi bi-plus-circle me-1"></i>Solicitar equipo
            </a>
            <a class="btn btn-light text-primary fw-bold" asp-action="ReportarIncidente" asp-route-tipo="Danio">
                Reportar daño
            </a>
            <a class="btn-agregar-equipo" asp-action="Principal">
                <i class="bi bi-arrow-left me-1"></i>Volver
            </a>
        </div>
    </div>

    <table class="table equipos-table">
        <thead>
            <tr>
                <th>Tipo</th>
                <th>Equipo</th>
                <th>Sala</th>
                <th>Desde</th>
                <th>Hasta</th>
                <th>Estado</th>
                <th>Descripción</th>
            </tr>
        </thead>
        <tbody>
            @if (Model == null || Model.Count == 0)
            {
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">Aún no has registrado solicitudes</td>
                </tr>
            }
            else
            {
                foreach (var solicitud in Model)
                {
                    var estadoClase = solicitud.Estado switch
                    {
                        "Pendiente" => "tag tag-mantenimiento",
                        "Aceptado" => "tag tag-disponible",
                        "Denegado" => "tag tag-bloqueado",
                        _ => "tag tag-mantenimiento"
                    };

                    <tr>
                        <td>@solicitud.Tipo</td>
                        <td>@(equipos.TryGetValue(solicitud.ComputadorId, out var equipo) ? equipo : solicitud.ComputadorId.ToString())</td>
                        <td>@(solicitud.SalaId.HasValue && salas.TryGetValue(solicitud.SalaId.Value, out var salaNombre) ? salaNombre : "-")</td>
                        <td>@solicitud.FechaInicio.ToString("g")</td>
                        <td>@solicitud.FechaFin.ToString("g")</td>
                        <td><span class="@estadoClase">@solicitud.Estado</span></td>
                        <td>@(string.IsNullOrWhiteSpace(solicitud.Descripcion) ? "-" : solicitud.Descripcion)</td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>



