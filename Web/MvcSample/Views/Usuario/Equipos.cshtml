@using System.Linq
@model IList<Services.Models.ModelosComputador.ModeloComputador>

@{
    ViewData["Title"] = "Equipos disponibles";
    var estadoActual = ViewBag.Estado as string ?? "Todos";
    var salas = ViewBag.Salas as SelectList ?? new SelectList(Enumerable.Empty<SelectListItem>());
}

<div class="equipos-table-container">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <div>
            <h2>Equipos y estado</h2>
            <p>Filtra por sala o estado para ubicar un equipo disponible</p>
        </div>
        <a class="btn-agregar-equipo" asp-action="Principal">
            <i class="bi bi-arrow-left me-1"></i>Volver
        </a>
    </div>

    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <label class="form-label text-muted">Sala</label>
            @Html.DropDownList("salaId", salas, "-- Todas --", new { @class = "form-select", onchange = "this.form.submit()" })
        </div>
        <div class="col-md-4">
            <label class="form-label text-muted">Estado</label>
            <select name="estado" class="form-select" onchange="this.form.submit()">
                <option value="Todos" @(estadoActual == "Todos" ? "selected" : "")>Todos</option>
                <option value="Disponible" @(estadoActual == "Disponible" ? "selected" : "")>Disponible</option>
                <option value="Ocupado" @(estadoActual == "Ocupado" ? "selected" : "")>Ocupado</option>
                <option value="Bloqueado" @(estadoActual == "Bloqueado" ? "selected" : "")>Bloqueado</option>
            </select>
        </div>
    </form>

    <table class="table equipos-table">
        <thead>
            <tr>
                <th>Equipo</th>
                <th>Sala</th>
                <th>Estado</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (Model == null || Model.Count == 0)
            {
                <tr>
                    <td colspan="4" class="text-center text-muted py-4">No hay equipos con ese criterio</td>
                </tr>
            }
            else
            {
                foreach (var equipo in Model)
                {
                    var estadoClase = equipo.Estado switch
                    {
                        "Disponible" => "tag tag-disponible",
                        "Ocupado" => "tag tag-ocupado",
                        "Bloqueado" => "tag tag-bloqueado",
                        _ => "tag tag-mantenimiento"
                    };

                    <tr>
                        <td>@equipo.Nombre</td>
                        <td>@(string.IsNullOrWhiteSpace(equipo.SalaDisplay) ? "Sin sala" : equipo.SalaDisplay)</td>
                        <td><span class="@estadoClase">@equipo.Estado</span></td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary" asp-action="CrearSolicitud" asp-route-tipo="Asignacion" asp-route-computadorId="@equipo.Id">
                                Solicitar uso
                            </a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

